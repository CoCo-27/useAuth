function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("auth0-js")),r=require("react"),n=e(r),u=function(e,t){switch(t.type){case"login":var r=t.authResult,n=t.user,u=1e3*r.expiresIn+(new Date).getTime();return"undefined"!=typeof localStorage&&(localStorage.setItem("expires_at",JSON.stringify(u)),localStorage.setItem("user",JSON.stringify(n))),Object.assign({},e,{user:n,expiresAt:u,authResult:r});case"logout":return"undefined"!=typeof localStorage&&(localStorage.removeItem("expires_at"),localStorage.removeItem("user")),Object.assign({},e,{user:{},expiresAt:null,authResult:null});case"stopAuthenticating":return Object.assign({},e,{isAuthenticating:!1});case"startAuthenticating":return Object.assign({},e,{isAuthenticating:!0});case"error":return Object.assign({},e,{user:{},expiresAt:null,authResult:null,errorType:t.errorType,error:t.error});default:return e}},i=function(e){var t=e.err,r=e.dispatch,n=e.auth0,u=e.authResult;try{return r({type:"stopAuthenticating"}),u&&u.accessToken&&u.idToken?Promise.resolve(function(e){var t=e.dispatch,r=e.auth0,n=e.authResult;try{return Promise.resolve(new Promise(function(e,u){r.client.userInfo(n.accessToken||"",function(r,i){r?(t({type:"error",errorType:"userInfo",error:r}),u(r)):(t({type:"login",authResult:n,user:i}),e(i))})}))}catch(e){return Promise.reject(e)}}({dispatch:r,auth0:n,authResult:u})).then(function(){return!0}):t?(console.error(t),r({type:"error",error:t,errorType:"authResult"}),Promise.resolve(!1)):Promise.resolve(!1)}catch(e){return Promise.reject(e)}},o={user:{},expiresAt:null,isAuthenticating:!1},a=r.createContext({state:o,dispatch:function(){},auth0:null,callback_domain:"http://localhost:8000",navigate:function(e){}});exports.AuthProvider=function(e){var s=e.children,c=e.navigate,l=e.auth0_domain,h="undefined"!=typeof window?window.location.protocol+"//"+window.location.host:"http://localhost:8000",p=new t.WebAuth(Object.assign({},{domain:l,clientID:e.auth0_client_id,redirectUri:h+"/auth0_callback",audience:"https://"+l+"/api/v2/",responseType:"token id_token",scope:"openid profile email"},e.auth0_params)),d=r.useReducer(u,o),f=d[0],g=d[1],y=r.useState({state:f,dispatch:g,auth0:p,callback_domain:h,navigate:c}),m=y[0],v=y[1];return r.useEffect(function(){v(function(e){return Object.assign({},e,{state:f})})},[f]),r.useEffect(function(){g({type:"startAuthenticating"}),p.checkSession({},function(e,t){g({type:"stopAuthenticating"}),console.log(e),e?g({type:"error",errorType:"checkSession",error:e}):i({dispatch:g,auth0:p,authResult:t})})},[]),n.createElement(a.Provider,{value:m},s)},exports.useAuth=function(){var e=r.useContext(a),t=e.state,n=e.dispatch,u=e.auth0,o=e.callback_domain,s=e.navigate;return{isAuthenticating:t.isAuthenticating,isAuthenticated:function(){return!!(t.expiresAt&&(new Date).getTime()<t.expiresAt)},user:t.user,userId:t.user?t.user.sub:null,authResult:t.authResult,login:function(){u&&u.authorize()},logout:function(){u&&u.logout({returnTo:o}),n({type:"logout"}),s("/")},handleAuthentication:function(e){void 0===e&&(e={});var t=e.postLoginRoute;void 0===t&&(t="/"),"undefined"!=typeof window&&(n({type:"startAuthenticating"}),u&&u.parseHash(function(e,r){try{return Promise.resolve(i({err:e,authResult:r,dispatch:n,auth0:u})).then(function(){s(t)})}catch(e){return Promise.reject(e)}}))}}};
//# sourceMappingURL=index.js.map
