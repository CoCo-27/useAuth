{"version":3,"file":"index.js","sources":["../src/authReducer.js","../src/AuthProvider.js","../src/useAuth.js"],"sourcesContent":["export const authReducer = (state, action) => {\n    console.log('got me some local', localStorage)\n    switch (action.type) {\n        case \"login\":\n            const {\n                authResult, user\n            } = action;\n            const expiresAt =\n                authResult.expiresIn * 1000 + new Date().getTime();\n\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.setItem(\"access_token\", authResult.accessToken);\n                localStorage.setItem(\"id_token\", authResult.idToken);\n                localStorage.setItem(\"expires_at\", JSON.stringify(expiresAt));\n                localStorage.setItem(\"user\", JSON.stringify(user));\n            }\n\n            return {\n                user,\n                expiresAt\n            };\n        case \"logout\":\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.removeItem(\"access_token\");\n                localStorage.removeItem(\"id_token\");\n                localStorage.removeItem(\"expires_at\");\n                localStorage.removeItem(\"user\");\n            }\n\n            return {\n                user: {},\n                    expiresAt: null\n            };\n        default:\n            return state;\n    }\n};","import React, { createContext, useReducer } from \"react\";\nimport Auth0 from \"auth0-js\";\n\nimport { authReducer } from \"./authReducer\";\n\nexport const AuthContext = createContext(null);\n\nexport const AuthProvider = ({\n    children,\n    navigate,\n    auth0_domain,\n    auth0_client_id,\n    auth0_params\n}) => {\n    const callback_domain =\n        typeof window !== \"undefined\"\n            ? `${window.location.protocol}//${window.location.host}`\n            : \"http://localhost:8000\";\n\n    const params = {\n        domain: auth0_domain,\n        clientID: auth0_client_id,\n        redirectUri: `${callback_domain}/auth0_callback`,\n        audience: `https://${auth0_domain}/api/v2/`,\n        responseType: \"token id_token\",\n        scope: \"openid profile email\"\n    };\n\n    const auth0 = new Auth0.WebAuth({ ...params, ...auth0_params });\n\n    const [state, dispatch] = useReducer(authReducer, {\n        user:\n            typeof localStorage !== \"undefined\"\n                ? JSON.parse(localStorage.getItem(\"user\"))\n                : {},\n        expiresAt:\n            typeof localStorage !== \"undefined\"\n                ? JSON.parse(localStorage.getItem(\"expires_at\"))\n                : null\n    });\n\n    console.log(\"auth provider\", { state });\n\n    return (\n        <AuthContext.Provider\n            value={{\n                state,\n                dispatch,\n                auth0,\n                navigate\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    );\n};\n","import { useContext } from \"react\";\n\nimport { AuthContext } from \"./AuthProvider\";\n\nexport const useAuth = () => {\n    const { state, dispatch, auth0, navigate } = useContext(AuthContext);\n\n    console.log(3, { state });\n\n    const login = () => {\n        auth0.authorize();\n    };\n\n    const logout = () => {\n        dispatch({\n            type: \"logout\"\n        });\n\n        // Return to the homepage after logout.\n        navigate(\"/\");\n    };\n\n    const handleAuthentication = () => {\n        if (typeof window !== \"undefined\") {\n            auth0.parseHash((err, authResult) => {\n                console.log(2, { err, authResult });\n                if (\n                    authResult &&\n                    authResult.accessToken &&\n                    authResult.idToken\n                ) {\n                    setSession(authResult);\n                } else if (err) {\n                    console.log(err);\n                }\n            });\n        }\n    };\n\n    const setSession = authResult => {\n        auth0.client.userInfo(authResult.accessToken, (err, user) => {\n            console.log(1, { err, user });\n            if (err) {\n                console.log(err);\n            } else {\n                dispatch({\n                    type: \"login\",\n                    authResult,\n                    user\n                });\n            }\n\n            // navigate(\"/\");\n        });\n    };\n\n    const isAuthenticated = () => {\n        return state.expiresAt && new Date().getTime() < state.expiresAt;\n    };\n\n    return {\n        isAuthenticated,\n        user: state.user,\n        userId: state.user ? state.user.sub : null,\n        login,\n        logout,\n        handleAuthentication\n    };\n};\n"],"names":["authReducer","state","action","console","log","localStorage","type","expiresAt","authResult","expiresIn","Date","getTime","setItem","accessToken","idToken","JSON","stringify","user","removeItem","AuthContext","createContext","ref","callback_domain","window","location","auth0","Auth0","WebAuth","Object","domain","auth0_domain","clientID","redirectUri","audience","responseType","scope","useReducer","parse","getItem","React","Provider","value","dispatch","navigate","children","useContext","userId","sub","authorize","parseHash","err","client","userInfo","setSession"],"mappings":"6HAAaA,WAAeC,EAAOC,UAC/BC,QAAQC,IAAI,oBAAqBC,cACzBH,EAAOI,UACN,oCAIKC,EACqB,IAAvBC,EAAWC,WAAmB,IAAIC,MAAOC,gBAEjB,oBAAjBN,eACPA,aAAaO,QAAQ,eAAgBJ,EAAWK,aAChDR,aAAaO,QAAQ,WAAYJ,EAAWM,SAC5CT,aAAaO,QAAQ,aAAcG,KAAKC,UAAUT,IAClDF,aAAaO,QAAQ,OAAQG,KAAKC,UAAUC,KAGzC,MACHA,YACAV,OAEH,eAC2B,oBAAjBF,eACPA,aAAaa,WAAW,gBACxBb,aAAaa,WAAW,YACxBb,aAAaa,WAAW,cACxBb,aAAaa,WAAW,SAGrB,CACHD,KAAM,GACFV,UAAW,qBAGZN,IC7BNkB,EAAcC,gBAAc,oCAEZC,kDAOnBC,EACgB,oBAAXC,OACEA,OAAOC,uBAAsBD,OAAOC,SAAc,KACrD,wBAWJC,EAAQ,IAAIC,EAAMC,QAAQC,iBATjB,CACXC,OAAQC,EACRC,2BACAC,YAAgBV,oBAChBW,oBAAqBH,aACrBI,aAAc,iBACdC,MAAO,2CAKeC,aAAWpC,EAAa,CAC9CiB,KAC4B,oBAAjBZ,aACDU,KAAKsB,MAAMhC,aAAaiC,QAAQ,SAChC,GACV/B,UAC4B,oBAAjBF,aACDU,KAAKsB,MAAMhC,aAAaiC,QAAQ,eAChC,4BAGdnC,QAAQC,IAAI,gBAAiB,OAAEH,IAG3BsC,gBAACpB,EAAYqB,UACTC,MAAO,OACHxC,WACAyC,QACAjB,WACAkB,IAGHC,qCC/CoCC,aAAW1B,wDAExDhB,QAAQC,IAAI,EAAG,OAAEH,IAqDV,mCAHIA,EAAMM,YAAa,IAAIG,MAAOC,UAAYV,EAAMM,WAKvDU,KAAMhB,EAAMgB,KACZ6B,OAAQ7C,EAAMgB,KAAOhB,EAAMgB,KAAK8B,IAAM,sBArDtCtB,EAAMuB,+BAINN,EAAS,CACLpC,KAAM,WAIVqC,EAAS,sCAIa,oBAAXpB,QACPE,EAAMwB,mBAAWC,EAAK1C,GAClBL,QAAQC,IAAI,EAAG,KAAE8C,aAAK1C,IAElBA,GACAA,EAAWK,aACXL,EAAWM,iBAURN,GACfiB,EAAM0B,OAAOC,SAAS5C,EAAWK,qBAAcqC,EAAKjC,GAChDd,QAAQC,IAAI,EAAG,KAAE8C,OAAKjC,IAClBiC,EACA/C,QAAQC,IAAI8C,GAEZR,EAAS,CACLpC,KAAM,mBACNE,OACAS,MAjBAoC,CAAW7C,GACJ0C,GACP/C,QAAQC,IAAI8C"}