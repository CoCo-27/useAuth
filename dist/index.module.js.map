{"version":3,"file":"index.module.js","sources":["../src/authReducer.js","../src/useAuth.js","../src/AuthProvider.js"],"sourcesContent":["export const authReducer = (state, action) => {\n    switch (action.type) {\n        case \"login\":\n            const { authResult, user } = action;\n            const expiresAt =\n                authResult.expiresIn * 1000 + new Date().getTime();\n\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.setItem(\"expires_at\", JSON.stringify(expiresAt));\n                localStorage.setItem(\"user\", JSON.stringify(user));\n            }\n\n            return {\n                user,\n                expiresAt\n            };\n        case \"logout\":\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.removeItem(\"expires_at\");\n                localStorage.removeItem(\"user\");\n            }\n\n            return {\n                user: {},\n                expiresAt: null\n            };\n        case \"error\":\n            const { errorType, error } = action;\n            return {\n                user: {},\n                expiresAt: null,\n                errorType,\n                error\n            };\n        default:\n            return state;\n    }\n};\n","import { useContext } from \"react\";\n\nimport { AuthContext } from \"./AuthProvider\";\n\nasync function setSession({ dispatch, auth0, authResult }) {\n    return new Promise((resolve, reject) => {\n        auth0.client.userInfo(authResult.accessToken, (err, user) => {\n            if (err) {\n                dispatch({\n                    type: \"error\",\n                    errorType: \"userInfo\",\n                    error: err\n                });\n                reject(err);\n            } else {\n                dispatch({\n                    type: \"login\",\n                    authResult,\n                    user\n                });\n                resolve(user);\n            }\n        });\n    });\n}\n\nexport const handleAuthResult = async ({ dispatch, auth0, authResult }) => {\n    if (authResult && authResult.accessToken && authResult.idToken) {\n        await setSession({ dispatch, auth0, authResult });\n\n        return true;\n    } else if (err) {\n        console.error(err);\n        dispatch({\n            type: \"error\",\n            error: err,\n            errorType: \"authResult\"\n        });\n\n        return false;\n    }\n};\n\nexport const useAuth = () => {\n    const { state, dispatch, auth0, callback_domain, navigate } = useContext(\n        AuthContext\n    );\n\n    const login = () => {\n        auth0.authorize();\n    };\n\n    const logout = () => {\n        auth0.logout({\n            returnTo: callback_domain\n        });\n        dispatch({\n            type: \"logout\"\n        });\n\n        // Return to the homepage after logout.\n        navigate(\"/\");\n    };\n\n    const handleAuthentication = () => {\n        if (typeof window !== \"undefined\") {\n            auth0.parseHash(async (err, authResult) => {\n                await handleAuthResult({ err, authResult, dispatch, auth0 });\n\n                navigate(\"/\");\n            });\n        }\n    };\n\n    const isAuthenticated = () => {\n        return state.expiresAt && new Date().getTime() < state.expiresAt;\n    };\n\n    return {\n        isAuthenticated,\n        user: state.user,\n        userId: state.user ? state.user.sub : null,\n        login,\n        logout,\n        handleAuthentication\n    };\n};\n","import React, { createContext, useReducer, useEffect } from \"react\";\nimport Auth0 from \"auth0-js\";\n\nimport { authReducer } from \"./authReducer\";\nimport { handleAuthResult } from \"./useAuth\";\n\nexport const AuthContext = createContext(null);\n\nexport const AuthProvider = ({\n    children,\n    navigate,\n    auth0_domain,\n    auth0_client_id,\n    auth0_params\n}) => {\n    const callback_domain =\n        typeof window !== \"undefined\"\n            ? `${window.location.protocol}//${window.location.host}`\n            : \"http://localhost:8000\";\n\n    const params = {\n        domain: auth0_domain,\n        clientID: auth0_client_id,\n        redirectUri: `${callback_domain}/auth0_callback`,\n        audience: `https://${auth0_domain}/api/v2/`,\n        responseType: \"token id_token\",\n        scope: \"openid profile email\"\n    };\n\n    const auth0 = new Auth0.WebAuth({ ...params, ...auth0_params });\n\n    const [state, dispatch] = useReducer(authReducer, {\n        user: {},\n        expiresAt: null\n    });\n\n    useEffect(() => {\n        auth0.checkSession({}, (err, authResult) => {\n            if (err) {\n                dispatch({\n                    type: \"error\",\n                    erroType: \"checkSession\",\n                    error: err\n                });\n            } else {\n                handleAuthResult({ dispatch, auth0, authResult });\n            }\n        });\n    }, []);\n\n    return (\n        <AuthContext.Provider\n            value={{\n                state,\n                dispatch,\n                auth0,\n                callback_domain,\n                navigate\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    );\n};\n"],"names":["const","authReducer","state","action","type","expiresAt","expiresIn","Date","getTime","localStorage","setItem","JSON","stringify","user","removeItem","handleAuthResult","ref","authResult","accessToken","idToken","Promise","resolve","reject","auth0","client","userInfo","err","dispatch","errorType","error","setSession","console","useAuth","useContext","AuthContext","userId","sub","authorize","logout","returnTo","callback_domain","navigate","window","parseHash","createContext","AuthProvider","location","Auth0","WebAuth","Object","domain","auth0_domain","clientID","redirectUri","audience","responseType","scope","useReducer","useEffect","checkSession","erroType","React","Provider","value","children"],"mappings":"gHAAOA,IAAMC,WAAeC,EAAOC,UACvBA,EAAOC,UACN,qBAEKC,EACqB,iBAAZC,WAAmB,IAAIC,MAAOC,gBAEjB,oBAAjBC,eACPA,aAAaC,QAAQ,aAAcC,KAAKC,UAAUP,IAClDI,aAAaC,QAAQ,OAAQC,KAAKC,UAAUC,KAGzC,MACHA,YACAR,OAEH,eAC2B,oBAAjBI,eACPA,aAAaK,WAAW,cACxBL,aAAaK,WAAW,SAGrB,CACHD,KAAM,GACNR,UAAW,UAEd,cAEM,CACHQ,KAAM,GACNR,UAAW,yDAKRH,ICTNa,WAA0BC,wEAC/BC,GAAcA,EAAWC,aAAeD,EAAWE,iCAvBjCH,wEACf,IAAII,iBAASC,EAASC,GACzBC,EAAMC,OAAOC,SAASR,EAAWC,qBAAcQ,EAAKb,GAC5Ca,GACAC,EAAS,CACLvB,KAAM,QACNwB,UAAW,WACXC,MAAOH,IAEXJ,EAAOI,KAEPC,EAAS,CACLvB,KAAM,mBACNa,OACAJ,IAEJQ,EAAQR,4CAQViB,CAAW,UAAEH,QAAUJ,aAAON,4BAE7B,IACAS,KACPK,QAAQF,MAAMH,KACdC,EAAS,CACLvB,KAAM,QACNyB,MAAOH,IACPE,UAAW,gBAGR,QARJ,uCAYEI,mBACqDC,EAC1DC,2EAiCG,mCAHIhC,EAAMG,YAAa,IAAIE,MAAOC,UAAYN,EAAMG,WAKvDQ,KAAMX,EAAMW,KACZsB,OAAQjC,EAAMW,KAAOX,EAAMW,KAAKuB,IAAM,sBAhCtCb,EAAMc,+BAINd,EAAMe,OAAO,CACTC,SAAUC,IAEdb,EAAS,CACLvB,KAAM,WAIVqC,EAAS,sCAIa,oBAAXC,QACPnB,EAAMoB,mBAAiBjB,EAAKT,8BAClBF,EAAiB,KAAEW,aAAKT,WAAYU,QAAUJ,qBAEpDkB,EAAS,+CC/DZP,EAAcU,EAAc,MAE5BC,WAAgB7B,kDAOnBwB,EACgB,oBAAXE,OACEA,OAAOI,uBAAsBJ,OAAOI,SAAc,KACrD,wBAWJvB,EAAQ,IAAIwB,EAAMC,QAAQC,iBATjB,CACXC,OAAQC,EACRC,2BACAC,YAAgBb,oBAChBc,oBAAqBH,aACrBI,aAAc,iBACdC,MAAO,2CAKeC,EAAWxD,EAAa,CAC9CY,KAAM,GACNR,UAAW,4BAGfqD,aACInC,EAAMoC,aAAa,YAAKjC,EAAKT,GACrBS,EACAC,EAAS,CACLvB,KAAM,QACNwD,SAAU,eACV/B,MAAOH,IAGXX,EAAiB,UAAEY,QAAUJ,aAAON,OAG7C,IAGC4C,gBAAC3B,EAAY4B,UACTC,MAAO,OACH7D,WACAyB,QACAJ,kBACAiB,WACAC,IAGHuB"}