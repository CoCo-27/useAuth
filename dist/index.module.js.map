{"version":3,"file":"index.module.js","sources":["../src/authReducer.js","../src/AuthProvider.js","../src/useAuth.js"],"sourcesContent":["export const authReducer = (state, action) => {\n    switch (action.type) {\n        case \"login\":\n            const { authResult, user } = action;\n            const expiresAt =\n                authResult.expiresIn * 1000 + new Date().getTime();\n\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.setItem(\"access_token\", authResult.accessToken);\n                localStorage.setItem(\"id_token\", authResult.idToken);\n                localStorage.setItem(\"expires_at\", JSON.stringify(expiresAt));\n                localStorage.setItem(\"user\", JSON.stringify(user));\n            }\n\n            return {\n                user,\n                expiresAt\n            };\n        case \"logout\":\n            if (typeof localStorage !== \"undefined\") {\n                localStorage.removeItem(\"access_token\");\n                localStorage.removeItem(\"id_token\");\n                localStorage.removeItem(\"expires_at\");\n                localStorage.removeItem(\"user\");\n            }\n\n            return {\n                user: {},\n                expiresAt: null\n            };\n        case \"error\":\n            const { errorType, error } = action;\n            return {\n                user: {},\n                expiresAt: null,\n                errorType,\n                error\n            };\n        default:\n            return state;\n    }\n};\n","import React, { createContext, useReducer } from \"react\";\nimport Auth0 from \"auth0-js\";\n\nimport { authReducer } from \"./authReducer\";\n\nexport const AuthContext = createContext(null);\n\nexport const AuthProvider = ({\n    children,\n    navigate,\n    auth0_domain,\n    auth0_client_id,\n    auth0_params\n}) => {\n    const callback_domain =\n        typeof window !== \"undefined\"\n            ? `${window.location.protocol}//${window.location.host}`\n            : \"http://localhost:8000\";\n\n    const params = {\n        domain: auth0_domain,\n        clientID: auth0_client_id,\n        redirectUri: `${callback_domain}/auth0_callback`,\n        audience: `https://${auth0_domain}/api/v2/`,\n        responseType: \"token id_token\",\n        scope: \"openid profile email\"\n    };\n\n    const auth0 = new Auth0.WebAuth({ ...params, ...auth0_params });\n\n    const [state, dispatch] = useReducer(authReducer, {\n        user:\n            typeof localStorage !== \"undefined\"\n                ? JSON.parse(localStorage.getItem(\"user\"))\n                : {},\n        expiresAt:\n            typeof localStorage !== \"undefined\"\n                ? JSON.parse(localStorage.getItem(\"expires_at\"))\n                : null\n    });\n\n    return (\n        <AuthContext.Provider\n            value={{\n                state,\n                dispatch,\n                auth0,\n                navigate\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    );\n};\n","import { useContext } from \"react\";\n\nimport { AuthContext } from \"./AuthProvider\";\n\nexport const useAuth = () => {\n    const { state, dispatch, auth0, navigate } = useContext(AuthContext);\n\n    const login = () => {\n        auth0.authorize();\n    };\n\n    const logout = () => {\n        dispatch({\n            type: \"logout\"\n        });\n\n        // Return to the homepage after logout.\n        navigate(\"/\");\n    };\n\n    const handleAuthentication = () => {\n        if (typeof window !== \"undefined\") {\n            auth0.parseHash((err, authResult) => {\n                if (\n                    authResult &&\n                    authResult.accessToken &&\n                    authResult.idToken\n                ) {\n                    setSession(authResult);\n                } else if (err) {\n                    console.error(err);\n                    dispatch({\n                        type: \"error\",\n                        error: err,\n                        errorType: \"authResult\"\n                    });\n                }\n            });\n        }\n    };\n\n    const setSession = authResult => {\n        auth0.client.userInfo(authResult.accessToken, (err, user) => {\n            if (err) {\n                console.error(err);\n                dispatch({\n                    type: \"error\",\n                    errorType: \"userInfo\",\n                    error: err\n                });\n            } else {\n                dispatch({\n                    type: \"login\",\n                    authResult,\n                    user\n                });\n            }\n\n            navigate(\"/\");\n        });\n    };\n\n    const isAuthenticated = () => {\n        return state.expiresAt && new Date().getTime() < state.expiresAt;\n    };\n\n    return {\n        isAuthenticated,\n        user: state.user,\n        userId: state.user ? state.user.sub : null,\n        login,\n        logout,\n        handleAuthentication\n    };\n};\n"],"names":["const","authReducer","state","action","type","expiresAt","authResult","expiresIn","Date","getTime","localStorage","setItem","accessToken","idToken","JSON","stringify","user","removeItem","AuthContext","createContext","AuthProvider","ref","callback_domain","window","location","auth0","Auth0","WebAuth","Object","domain","auth0_domain","clientID","redirectUri","audience","responseType","scope","useReducer","parse","getItem","React","Provider","value","navigate","children","useAuth","useContext","userId","sub","authorize","dispatch","parseHash","err","client","userInfo","console","error","errorType","setSession"],"mappings":"iGAAOA,IAAMC,WAAeC,EAAOC,UACvBA,EAAOC,UACN,oCAEKC,EACqB,IAAvBC,EAAWC,WAAmB,IAAIC,MAAOC,gBAEjB,oBAAjBC,eACPA,aAAaC,QAAQ,eAAgBL,EAAWM,aAChDF,aAAaC,QAAQ,WAAYL,EAAWO,SAC5CH,aAAaC,QAAQ,aAAcG,KAAKC,UAAUV,IAClDK,aAAaC,QAAQ,OAAQG,KAAKC,UAAUC,KAGzC,MACHA,YACAX,OAEH,eAC2B,oBAAjBK,eACPA,aAAaO,WAAW,gBACxBP,aAAaO,WAAW,YACxBP,aAAaO,WAAW,cACxBP,aAAaO,WAAW,SAGrB,CACHD,KAAM,GACNX,UAAW,UAEd,cAEM,CACHW,KAAM,GACNX,UAAW,yDAKRH,IClCNgB,EAAcC,EAAc,MAE5BC,WAAgBC,kDAOnBC,EACgB,oBAAXC,OACEA,OAAOC,uBAAsBD,OAAOC,SAAc,KACrD,wBAWJC,EAAQ,IAAIC,EAAMC,QAAQC,iBATjB,CACXC,OAAQC,EACRC,2BACAC,YAAgBV,oBAChBW,oBAAqBH,aACrBI,aAAc,iBACdC,MAAO,2CAKeC,EAAWnC,EAAa,CAC9Ce,KAC4B,oBAAjBN,aACDI,KAAKuB,MAAM3B,aAAa4B,QAAQ,SAChC,GACVjC,UAC4B,oBAAjBK,aACDI,KAAKuB,MAAM3B,aAAa4B,QAAQ,eAChC,cAIVC,gBAACrB,EAAYsB,UACTC,MAAO,gCAGHhB,WACAiB,IAGHC,IC9CAC,mBACoCC,EAAW3B,uDA6DjD,mCAHIhB,EAAMG,YAAa,IAAIG,MAAOC,UAAYP,EAAMG,WAKvDW,KAAMd,EAAMc,KACZ8B,OAAQ5C,EAAMc,KAAOd,EAAMc,KAAK+B,IAAM,sBA7DtCtB,EAAMuB,+BAINC,EAAS,CACL7C,KAAM,WAIVsC,EAAS,sCAIa,oBAAXnB,QACPE,EAAMyB,mBAAWC,EAAK7C,GAEdA,GACAA,EAAWM,aACXN,EAAWO,iBAeRP,GACfmB,EAAM2B,OAAOC,SAAS/C,EAAWM,qBAAcuC,EAAKnC,GAC5CmC,GACAG,QAAQC,MAAMJ,GACdF,EAAS,CACL7C,KAAM,QACNoD,UAAW,WACXD,MAAOJ,KAGXF,EAAS,CACL7C,KAAM,mBACNE,OACAU,IAIR0B,EAAS,OA9BDe,CAAWnD,GACJ6C,IACPG,QAAQC,MAAMJ,GACdF,EAAS,CACL7C,KAAM,QACNmD,MAAOJ,EACPK,UAAW"}