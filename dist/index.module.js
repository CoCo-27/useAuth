import e from"auth0-js";import t,{useContext as r,createContext as n,useReducer as i,useEffect as o,useState as a}from"react";var u=function(e,t){switch(t.type){case"login":var r=t.authResult,n=t.user,i=1e3*r.expiresIn+(new Date).getTime();return"undefined"!=typeof localStorage&&(localStorage.setItem("expires_at",JSON.stringify(i)),localStorage.setItem("user",JSON.stringify(n))),Object.assign({},e,{user:n,expiresAt:i,authResult:r});case"logout":return"undefined"!=typeof localStorage&&(localStorage.removeItem("expires_at"),localStorage.removeItem("user")),Object.assign({},e,{user:{},expiresAt:null,authResult:null});case"stopAuthenticating":return Object.assign({},e,{isAuthenticating:!1});case"startAuthenticating":return Object.assign({},e,{isAuthenticating:!0});case"error":return Object.assign({},e,{user:{},expiresAt:null,authResult:null,errorType:t.errorType,error:t.error});default:return e}},s=function(e){var t=e.err,r=e.dispatch,n=e.auth0,i=e.authResult;try{return r({type:"stopAuthenticating"}),i&&i.accessToken&&i.idToken?Promise.resolve(function(e){var t=e.dispatch,r=e.auth0,n=e.authResult;try{return Promise.resolve(new Promise(function(e,i){r.client.userInfo(n.accessToken||"",function(r,o){r?(t({type:"error",errorType:"userInfo",error:r}),i(r)):(t({type:"login",authResult:n,user:o}),e(o))})}))}catch(e){return Promise.reject(e)}}({dispatch:r,auth0:n,authResult:i})).then(function(){return!0}):t?(console.error(t),r({type:"error",error:t,errorType:"authResult"}),Promise.resolve(!1)):Promise.resolve(!1)}catch(e){return Promise.reject(e)}},c=function(){var e=r(h),t=e.state,n=e.dispatch,i=e.auth0,o=e.callback_domain,a=e.navigate;return{isAuthenticating:t.isAuthenticating,isAuthenticated:function(){return!!(t.expiresAt&&(new Date).getTime()<t.expiresAt)},user:t.user,userId:t.user?t.user.sub:null,authResult:t.authResult,login:function(){i&&i.authorize()},logout:function(){i&&i.logout({returnTo:o}),n({type:"logout"}),a("/")},handleAuthentication:function(e){void 0===e&&(e={});var t=e.postLoginRoute;void 0===t&&(t="/"),"undefined"!=typeof window&&(n({type:"startAuthenticating"}),i&&i.parseHash(function(e,r){try{return Promise.resolve(s({err:e,authResult:r,dispatch:n,auth0:i})).then(function(){a(t)})}catch(e){return Promise.reject(e)}}))}}},l={user:{},expiresAt:null,isAuthenticating:!1},h=n({state:l,dispatch:function(){},auth0:null,callback_domain:"http://localhost:8000",navigate:function(e){}}),p=function(r){var n=r.children,c=r.navigate,p=r.auth0_domain,g="undefined"!=typeof window?window.location.protocol+"//"+window.location.host:"http://localhost:8000",d=new e.WebAuth(Object.assign({},{domain:p,clientID:r.auth0_client_id,redirectUri:g+"/auth0_callback",audience:"https://"+p+"/api/v2/",responseType:"token id_token",scope:"openid profile email"},r.auth0_params)),f=i(u,l),m=f[0],y=f[1],v=a({state:m,dispatch:y,auth0:d,callback_domain:g,navigate:c}),A=v[0],R=v[1];return o(function(){R(function(e){return Object.assign({},e,{state:m})})},[m]),o(function(){y({type:"startAuthenticating"}),d.checkSession({},function(e,t){y({type:"stopAuthenticating"}),console.log(e),e?y({type:"error",errorType:"checkSession",error:e}):s({dispatch:y,auth0:d,authResult:t})})},[]),t.createElement(h.Provider,{value:A},n)};export{p as AuthProvider,c as useAuth};
//# sourceMappingURL=index.module.js.map
