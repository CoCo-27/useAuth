import e,{useContext as t,createContext as r,useReducer as a,useState as u,useEffect as n}from"react";import s from"auth0-js";const o=(e,t)=>{switch(t.type){case"login":const{authResult:r,user:a}=t,u=1e3*r.expiresIn+(new Date).getTime();return"undefined"!=typeof localStorage&&(localStorage.setItem("useAuth:expires_at",JSON.stringify(u)),localStorage.setItem("useAuth:user",JSON.stringify(a))),{...e,user:a,expiresAt:u,authResult:r};case"logout":return"undefined"!=typeof localStorage&&(localStorage.removeItem("useAuth:expires_at"),localStorage.removeItem("useAuth:user")),{...e,user:{},expiresAt:null,authResult:null};case"stopAuthenticating":return{...e,isAuthenticating:!1};case"startAuthenticating":return{...e,isAuthenticating:!0};case"error":const{errorType:n,error:s}=t;return{...e,user:{},expiresAt:null,authResult:null,errorType:n,error:s};default:return e}},i=async({err:e,dispatch:t,auth0:r,authResult:a})=>{if(t({type:"stopAuthenticating"}),!(a&&a.accessToken&&a.idToken))return!!e&&(console.error(e),t({type:"error",error:e,errorType:"authResult"}),!1);try{return await(async({dispatch:e,auth0:t,authResult:r})=>new Promise((a,u)=>{t.client.userInfo(r.accessToken||"",(t,n)=>{t?(e({type:"error",errorType:"userInfo",error:t}),u(t)):(e({type:"login",authResult:r,user:n}),a(n))})}))({dispatch:t,auth0:r,authResult:a}),!0}catch(e){return!1}},c=()=>{const{state:e,dispatch:r,auth0:a,callback_domain:u,navigate:n}=t(h);return{isAuthenticating:e.isAuthenticating,isAuthenticated:()=>!!(e.expiresAt&&(new Date).getTime()<e.expiresAt),user:e.user,userId:e.user?e.user.sub:null,authResult:e.authResult,login:()=>{a&&a.authorize()},signup:()=>{a&&a.authorize({screen_hint:"signup"})},logout:()=>{a&&a.logout({returnTo:u}),r({type:"logout"}),n("/")},handleAuthentication:({postLoginRoute:e="/"}={})=>{"undefined"!=typeof window&&(r({type:"startAuthenticating"}),a&&a.parseHash(async(t,u)=>{await i({err:t,authResult:u,dispatch:r,auth0:a}),n(e)}))}}};function l(){let e={};if("undefined"!=typeof localStorage){const t=new Date(JSON.parse(localStorage.getItem("useAuth:expires_at")||"0"));t>new Date&&(e={user:JSON.parse(localStorage.getItem("useAuth:user")||"{}"),expiresAt:t})}return{user:{},expiresAt:null,isAuthenticating:!1,...e}}const h=r({state:l(),dispatch:()=>{},auth0:null,callback_domain:"http://localhost:8000",navigate:e=>{}}),p=({children:t,navigate:r,auth0_audience_domain:c,auth0_domain:p,auth0_client_id:d,auth0_params:g})=>{const y="undefined"!=typeof window?`${window.location.protocol}//${window.location.host}`:"http://localhost:8000",A=new s.WebAuth({domain:p,clientID:d,redirectUri:y+"/auth0_callback",audience:`https://${c||p}/api/v2/`,responseType:"token id_token",scope:"openid profile email",...g}),[m,f]=a(o,l()),[w,S]=u({state:m,dispatch:f,auth0:A,callback_domain:y,navigate:r});return n(()=>{S(e=>({...e,state:m}))},[m]),n(()=>{f({type:"startAuthenticating"}),A.checkSession({},(e,t)=>{f({type:"stopAuthenticating"}),console.log(e),e?f({type:"error",errorType:"checkSession",error:e}):i({dispatch:f,auth0:A,authResult:t})})},[]),e.createElement(h.Provider,{value:w},t)};export{p as AuthProvider,c as useAuth};
//# sourceMappingURL=index.modern.js.map
